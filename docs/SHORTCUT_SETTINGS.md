# 快捷键设置功能

CopyPathFinder 现在支持自定义快捷键设置，允许用户根据个人偏好调整复制路径的快捷键组合。

## 新增功能

### 1. 快捷键配置系统
- **结构化配置**: 使用 `ShortcutConfiguration` 结构存储快捷键信息
- **持久化存储**: 配置自动保存到 UserDefaults
- **实时预览**: 菜单中显示当前设置的快捷键组合
- **动态更新**: 修改后立即生效，无需重启应用

### 2. 设置界面
- **直观操作**: 点击"Settings"按钮打开设置面板
- **实时录制**: 点击"Change"按钮后按任意快捷键组合进行录制
- **安全验证**: 只接受包含修饰键的快捷键组合
- **即时反馈**: 录制成功后立即显示新的快捷键

### 3. 菜单更新
- **动态显示**: 主菜单显示当前快捷键组合（如 ⌘⇧C）
- **设置入口**: 新增"⚙️ Settings"菜单项
- **布局优化**: 调整菜单高度以容纳新功能

## 使用方法

### 修改快捷键
1. 点击状态栏图标打开菜单
2. 选择"⚙️ Settings"
3. 在"Copy Path Shortcut"部分点击"Change"按钮
4. 按下您想要设置的快捷键组合（必须包含 ⌘、⌥、⌃ 或 ⇧ 中的至少一个）
5. 快捷键将立即生效并自动保存

### 支持的修饰键
- **⌘ Command**: 常用功能键
- **⌥ Option**: 备选/选项键
- **⌃ Control**: 控制键
- **⇧ Shift**: 上档键

### 支持的字符键
- 字母键: A-Z
- 数字键: 0-9
- 符号键: -=[];',./`
- 功能键: Tab, Space, Return, Delete, Esc

## 技术实现

### 核心组件

#### 1. ShortcutConfiguration 结构
```swift
struct ShortcutConfiguration: Codable {
    let keyCode: Int      // 按键代码
    let modifiers: UInt   // 修饰键组合
}
```

#### 2. ShortcutManager 管理器
- `@Published` 响应式属性支持 SwiftUI 视图更新
- `loadShortcuts()` 和 `saveShortcuts()` 处理持久化
- `matchesCopyPathShortcut()` 验证快捷键匹配

#### 3. SettingsView 设置界面
- 实时快捷键录制功能
- 键盘事件监听和处理
- 用户友好的交互反馈

### 安全特性
- **类型安全**: 严格的类型检查防止运行时错误
- **内存管理**: 正确的事件监听器生命周期管理
- **输入验证**: 只接受有效的快捷键组合

## 兼容性

- ✅ macOS 10.15+ (Catalina 及以上)
- ✅ Swift 5.3+
- ✅ SwiftUI 框架
- ✅ NSEvent 全局监听
- ✅ UserDefaults 持久化

## 默认配置

- **默认快捷键**: ⌘⇧C (Command + Shift + C)
- **存储位置**: ~/Library/Preferences/com.copypathfinder.plist
- **自动备份**: 配置变更时自动保存

## 故障排除

### 快捷键不生效
1. 检查是否包含至少一个修饰键
2. 确认没有与其他应用快捷键冲突
3. 重启应用重新加载配置

### 设置面板无法打开
1. 确保应用有完整权限
2. 检查 macOS 安全设置
3. 尝试重启应用

### 配置丢失
1. 配置自动保存到系统偏好设置
2. 重置为默认配置：删除 UserDefaults 中的相关键值
3. 联系开发者获取技术支持

## 未来改进

- [ ] 支持多个快捷键绑定
- [ ] 快捷键冲突检测
- [ ] 预设快捷键方案
- [ ] 导入/导出配置
- [ ] 更多功能快捷键配置